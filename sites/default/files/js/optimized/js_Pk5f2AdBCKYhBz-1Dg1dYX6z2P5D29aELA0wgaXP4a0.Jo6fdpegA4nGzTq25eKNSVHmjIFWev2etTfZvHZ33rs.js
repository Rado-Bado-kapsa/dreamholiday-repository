/* Source and licensing information for the line(s) below can be found at https://www.dreamholiday.space/modules/imce/js/imce.Folder.js. */
(function(i,n,e){'use strict';e.Folder=function(e,t){this.construct(e,t)};var s=e.Item.prototype,t=i.extend(e.Folder.prototype,s);t.construct=function(e,t){var i=this;i.isFolder=!0;i.type='folder';i.items=[];i.files={};i.subfolders={};s.construct.apply(i,arguments);i.setConf(t)};t.createEl=function(){var n,r,i,t=this;if(!t.el){s.createEl.apply(t,arguments);t.el.className+=' folder';t.contentEl=e.createEl('<div class="imce-folder-content clearfix"></div>');t.subtreeEl=e.createEl('<div class="imce-subtree"></div>');i=t.branchEl=e.createEl('<div class="imce-branch"><span class="imce-branch-toggle"></span><span class="imce-branch-name imce-ficon"></span></div>');r=t.branchToggleEl=i.firstChild;r.onclick=e.eBranchToggleClick;n=t.branchNameEl=i.children[1];n.onclick=e.eBranchNameClick;i.Folder=n.Folder=r.Folder=t}};t.setContent=function(t){var s,i,r,n=this,o=n.getItems();for(s in o){if(!e.owns(o,s)){continue};i=o[s];r=i.isFolder?t.subfolders:t.files;if(!r||!e.owns(r,i.name)){if(!i.isFolder||!i.hasPredefinedPath()){n.removeItem(i)}}};n.extend(t.props);n.addContent(t);n.content=t;n.updateSubtree()};t.addContent=function(t,i){var n=this,s=t.files,r=t.subfolders;if(!s&&!r){return};n.addItems(s,'file');n.addItems(r,'folder');if(n.active){n.sortItems()}
else{n.needSort=1};n.sortTree();if(i&&n.active){var l,o,a;e.deselectAll();if(s){for(o in s){if(!e.owns(s,o)){continue};n.getItem(o).select()}};if(r){for(a in r){if(!e.owns(r,a)){continue};n.getItem(a).select()}};if(l=(o||a)){n.getItem(l).scrollIntoView()}}};t.addItems=function(t,i){var n,s,r=i==='folder'?e.Folder:e.File;if(t){for(s in t){if(n=this.getItem(s)){n.extend(t[s]);this.updateStatus()}
else{n=new r(s);n.extend(t[s]);this.appendItem(n)}}}};t.getItems=function(){return this.items.slice(0)};t.appendItem=function(e){var t=this,i=e.name,n;if(!t.validateAppend(e)){return};e.remove(!0);if(n=t.getItem(i)){n.remove()};t.items.push(e);e.parent=t;t.contentEl.appendChild(e.el);if(e.isFolder){t.prepareSubtree();t.subtreeEl.appendChild(e.branchEl);t.subfolders[i]=e;e.setPath((t.parent?t.path+'/':'')+e.name)}
else{t.files[i]=e};t.updateStatus()};t.removeItem=function(t,i,s){var r=t.name,n=this;if(t.parent!==n){return};if(!i){if(t.isFolder){for(s in t.items){if(!e.owns(t.items,s)){continue};t.removeItem(t.items[s])}}};t.deselect();t.setBusy(!1);if(t.isFolder){if(t.active){n.activate()};t.setPath(null);delete n.subfolders[r];e.removeEl(t.branchEl);n.updateSubtree()}
else{delete n.files[r]};n.items.splice(!s?n.indexOf(t):s,1);delete t.parent;e.removeEl(t.el);n.updateStatus()};t.setPath=function(t){var n,i=this,r=i.path,s=i.subfolders;if(r!==t){if(t==null){for(n in s){if(!e.owns(s,n)){continue};s[n].setPath(null)};delete e.tree[r];delete i.path}
else{i.path=t;e.tree[t]=i;i.setDisabled(!i.getConf());for(n in s){if(!e.owns(s,n)){continue};s[n].setPath(t+'/'+s[n].name)};i.updateStatus()}}};t.getPermission=function(t){return e.permissionInFolderConf(t,this.getConf())};t.getConf=function(){var t=this.conf,n;if(t){return t};if(n=this.parent){if(t=n.getConf()){if(e.permissionInFolderConf('browse_subfolders',t)){return i.extend({inherited:!0},t)}}}};t.setConf=function(e){if(this.conf!==e){this.conf=e;this.setDisabled(!this.getConf())}};t.open=function(e){if(e||!this.content){this.load()};this.activate()};t.load=function(){if(this.isReady()){this.setLoading(!0);e.ajax('browse',{activeFolder:this,customComplete:e.xFolderLoadComplete})}};t.activate=function(){var t=this,s=e.activeFolder,n=t.parent;if(!t.active){if(s){s.deactivate()};if(t.needSort){t.sortItems()};e.activeFolder=t;t.active=!0;i(t.branchEl).addClass('active');if(!t.loading){t.addContentToDom()};t.setContentVisibility(!0);while(n){n.expand();n=n.parent};t.updateHeader();t.updateStatus();e.trigger('activateFolder',t,s)}};t.deactivate=function(){var t=this;if(t.active){t.setContentVisibility(!1);e.deselectAll();e.activeFolder=null;t.active=!1;i(t.branchEl).removeClass('active')}};t.setLoading=function(t){var i=this;if(t){if(!i.loading){i.setBusy(!0);i.setState('loading');if(i.active){e.deselectAll()}}}
else if(i.loading){i.setBusy(!1);i.unsetState('loading');if(i.active){i.addContentToDom()}}};t.getItem=function(t){var i=this;if(e.owns(i.files,t)){return i.files[t]};if(e.owns(i.subfolders,t)){return i.subfolders[t]}};t.getItemAt=function(e){return this.items[e]};t.indexOf=function(e){return i.inArray(e,this.items)};t.selectAll=function(){for(var t in this.items){if(!e.owns(this.items,t)){continue};this.items[t].select()}};t.countItems=function(){return this.items.length};t.countSubfolders=function(){var t,i=0;for(t in this.subfolders){if(!e.owns(this.subfolders,t)){continue};i++};return i};t.onNameChange=function(e){s.onNameChange.apply(this,arguments);this.branchNameEl.innerHTML=n.checkPlain(this.name);this.branchNameEl.title=this.name};t.onItemNameChange=function(e,t){var i=this,n=e.name,s=e.isFolder?i.subfolders:i.files;delete s[t];s[n]=e;if(e.isFolder){e.setPath((i.parent?i.path+'/':'')+n)}};t.dblClick=function(){this.open()};t.addContentToDom=function(){var t=this.contentEl,i=e.contentEl;if(t.parentNode!==i){i.appendChild(t)}};t.setContentVisibility=function(e){var t=this.contentEl;t.style.display=e?'':'none';if(t.scrollTop){t.scrollTop=0}};t.prepareSubtree=function(){var t=this;if(t.subtreeEl.parentNode!==t.branchEl){t.branchEl.appendChild(t.subtreeEl);i(t.branchEl).removeClass('leaf');if(!t.active&&e.activeFolder){t.expanded=!0;t.shrink()}
else{t.expand()}}};t.updateSubtree=function(){if(!this.countSubfolders()){this.shrink();e.removeEl(this.subtreeEl);i(this.branchEl).addClass('leaf')}};t.expand=function(){if(!this.expanded){this.expanded=!0;i(this.branchEl).addClass('expanded');i(this.subtreeEl).show()}};t.shrink=function(){if(this.expanded){this.expanded=!1;i(this.branchEl).removeClass('expanded');i(this.subtreeEl).hide()}};t.updateStatus=function(){if(this.active){e.updateStatus()}};t.updateHeader=function(){if(this.active){e.updateHeader()}};t.sortItems=function(t,i){var r,o,n=this,s=n.items,a=n.activeSort||e.activeSort||e.local.activeSort||{};if(t==null){t=a.key||'name'};if(i==null){i=!!a.desc};n.needSort=0;if(o=e.sorters[t]){s.sort(o);if(i){s.reverse()};for(r in s){if(!e.owns(s,r)){continue};this.contentEl.appendChild(s[r].el)};n.activeSort={key:t,desc:i};n.updateHeader()}};t.sortTree=function(){var t,s=this,n=s.subfolders,i=[];for(t in n){if(!e.owns(n,t)){continue};i.push(n[t])};if(i.length>1){i.sort(e.sortBranchName);for(t in i){if(!e.owns(i,t)){continue};s.subtreeEl.appendChild(i[t].branchEl)}}};t.validateAppend=function(e,t){if(e===this){return!1};var i=e.parent;if(!i){return!0};if(!t&&i===this){return!1};if(e.isFolder){for(i=this.parent;i;i=i.parent){if(i===e){return!1}}};return!0};t.isPredefined=function(){return!!this.conf};t.hasPredefinedPath=function(){if(this.isPredefined()){return this};var e,t,i=this.subfolders;for(e in i){if(t=i[e].hasPredefinedPath()){return t}};return!1};t.formatStatus=function(){return'<div class="items">'+e.formatItemsStatus(this.countItems(),this.getSize())+'</div>'};t.getSize=function(){var t,n=0,i=this.files;for(t in i){if(!e.owns(i,t)){continue};n+=i[t].size||0};return n};e.eBranchNameClick=function(e){this.Folder.open();return!1};e.eBranchToggleClick=function(e){var t=this.Folder;if(t.countSubfolders()){if(t.expanded){t.shrink()}
else{t.expand()}}
else{t.open()};return!1};e.xFolderLoadComplete=function(e,t){var n,s=this,i=s.activeFolder,r=s.response;if(r&&(n=r.content)){i.setContent(n)};i.setLoading(!1);if(i.countSubfolders()){i.expand()}}})(jQuery,Drupal,imce);
/* Source and licensing information for the above line(s) can be found at https://www.dreamholiday.space/modules/imce/js/imce.Folder.js. */