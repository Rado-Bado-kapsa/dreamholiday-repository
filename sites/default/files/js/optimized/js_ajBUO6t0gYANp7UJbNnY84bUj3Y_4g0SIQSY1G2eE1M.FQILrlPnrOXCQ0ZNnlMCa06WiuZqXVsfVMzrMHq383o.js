/* Source and licensing information for the line(s) below can be found at https://www.dreamholiday.space/modules/imce/js/plugins/imce/imce.UploadQueue.js. */
(function(t,n,e){'use strict';e.UploadQueue=function(e){this.construct(e)};var i=e.UploadQueue.prototype;i.construct=function(e){var i=this;i.items={};i.queue=[];i.conf=t.extend({name:'files[imce][]'},e);i.createEl()};i.createEl=function(){var t=this,i=t.el,a,s;if(!i){i=t.el=e.createEl('<div class="imce-uq"><span class="imce-uq-button imce-ficon imce-ficon-plus"><span class="imce-uq-label">'+n.t('Add file')+'</span><input type="file" class="imce-uq-input" multiple /></span><div class="imce-uq-items"></div></div>');a=t.inputEl=i.firstChild.lastChild;a.onchange=e.eUqInputChange;if(s=t.conf.accept){a.accept=s};t.itemsEl=i.lastChild;i.Uq=a.Uq=t};return i};i.start=function(){var t=this;if(!t.running&&t.queue.length){if(t.next()){t.running=!0;e.uploadSetBusy(!0)}};return t.running};i.end=function(){if(this.running){this.running=!1;e.uploadSetBusy(!1);e.getTbb('upload').closePopup()}};i.next=function(){var t,e,i=this.queue.slice(0);for(t=0;e=i[t];t++){if(e.completed){e.remove()}
else if(e.start()){return e}};this.end()};i.selectFiles=function(t){var i,s,n,a,c=e.activeFolder.getPath();for(i=0;s=t[i];i++){if(e.validateFileUpload(s)){n=new e.UploadQueueItem(s,c);if(this.addItem(n)){if(!a){a={}};a[i]=n.id}
else{n.remove()}}};return a};i.getItem=function(e){return this.items[e]};i.addItem=function(e){var i,t=this,n=e.id;if(i=t.getItem(n)){i.remove(!0)};e.Uq=t;t.items[n]=t.queue[t.queue.length]=e;t.itemsEl.appendChild(e.el);return e};i.removeItem=function(i,n){var a=this,s=a.queue,c=t.inArray(i,s);if(c!==-1){s.splice(c,1);delete a.items[i.id];if(n){t(i.el).remove()}
else{t(i.el).fadeOut(1000,e.eUqItemFadeout)};return i}};i.ajaxPrepare=function(i){var s,n,r,a,u,o=this,l=i.file,c=i.destination;if(!l||!c||!(u=e.getFolder(c))){return};r=t(o.inputEl.form).serializeArray().concat([{name:'active_path',value:c}],i.formData||[]);a=new FormData();for(s=0;n=r[s];s++){if(n.name){a.append(n.name,n.value)}};a.append(o.conf.name,i.file);return t.extend(e.ajaxDefaults(),{data:a,processData:!1,contentType:!1,customBeforeSend:e.xUqItemBeforeSend,customComplete:e.xUqItemComplete,xhr:e.xUqItemXhr,itemId:i.id,activeFolder:u})};e.UploadQueueItem=function(e,t){this.construct(e,t)};var a=e.UploadQueueItem.prototype;a.construct=function(t,i){this.file=t;this.destination=i;this.id=e.joinPaths(i,t.name);this.createEl()};a.createEl=function(){var a,s,i=this,t=i.el,c=i.file;if(!t){s=n.checkPlain(c.name);t=i.el=e.createEl('<div class="imce-uqi"><div class="imce-uqi-cancel"></div><div class="imce-uqi-info"><span class="imce-uqi-name" title="'+s+'">'+s+'</span><span class="imce-uqi-size">'+e.formatSize(c.size)+'</span></div><div class="imce-uqi-progress"><div class="imce-uqi-bar"></div></div><div class="imce-uqi-percent">'+n.t('!percent%',{'!percent':0})+'</div></div>');t.Item=i;a=t.firstChild;a.onclick=e.eUqItemCancelClick;a.onmousedown=e.eUqItemCancelMousedown};return t};a.remove=function(e){var n,t=this,i=t.Uq;t.stop();if(i){i.removeItem(t,e)};t.Uq=t.xhr=t.file=t.formData=t.el.Item=null;return n};a.start=function(){var n,e=this,i=e.Uq;if(i&&!e.active&&!e.completed){if(n=i.ajaxPrepare(e)){e.active=!0;t(e.el).addClass('active');e.xhr=t.ajax(n);i.activeItem=e;return i.activeItem}}};a.stop=function(){var e=this;if(e.active){e.active=!1;t(e.el).removeClass('active');if(e.xhr){e.xhr.abort()};e.complete()}};a.complete=function(e){var i=this,a=i.Uq;if(!i.completed){i.completed=!0;i.status=e;t(i.el).addClass(e?'success':'fail');if(e){t('.imce-uqi-percent',i.el).html(n.t('!percent%',{'!percent':100}))};if(a&&a.activeItem===i){a.activeItem=null;if(a.running){a.next()}};i.stop()}};a.progress=function(e){t(this.el).find('.imce-uqi-percent').text(n.t('!percent%',{'!percent':e*1})).end().find('.imce-uqi-bar').css('width',e*1+'%')};e.eUqInputChange=function(){this.Uq.selectFiles(this.files);e.uploadResetInput(this);if(e.getConf('upload_auto_start',1)){t('.imce-upload-button',this.form).click()}};e.eUqItemCancelClick=function(e){var i=t(this).closest('.imce-uqi')[0].Item;if(i){i.remove(!0)};return!1};e.eUqItemCancelMousedown=function(e){return!1};e.eUqItemFadeout=function(){t(this).remove()};e.xUqItemBeforeSend=function(e){};e.xUqItemXhr=function(){var i=this.itemId,t=new XMLHttpRequest();t.upload.onprogress=function(t){var n=e.activeUq.getItem(i);if(n){n.progress(parseInt(t.loaded*100/t.total))}};return t};e.xUqItemComplete=function(t,i){var n=this,a=e.activeUq.getItem(n.itemId);i=!!(n.response&&n.response.added);if(a){a.complete(i)}}})(jQuery,Drupal,imce);
/* Source and licensing information for the above line(s) can be found at https://www.dreamholiday.space/modules/imce/js/plugins/imce/imce.UploadQueue.js. */